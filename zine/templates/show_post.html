{% extends "layout.html" %}
{% from "_comment.html" import render_comments, render_comment_editor %}
{% block title %}{{ post.title|e }}{% endblock %}
{% block contents %}
  <div class="post">
    <h2>{{ post.title|e }}</h2>
    <p class="meta">{% trans author='<a href="%s">%s</a>' %
      (url_for(post.author), post.author.display_name|e),
      pub_date=post.pub_date|datetimeformat|e -%}
        written by {{ author }}, on {{ pub_date }}.
    {%- endtrans %}</p>
    {% if post.intro %}
      <div class="intro">{{ post.intro }}</div>
    {% endif %}
    <div class="text" id="extended">{{ post.body }}</div>
    <p class="related">
      {{ _('Categories') }}:
      {% for category in post.categories -%}
        <a href="{{ url_for(category)|e }}">{{ category.name|e }}</a>
        {%- if not loop.last %}, {% endif %}
      {%- else -%}
        {{ _("nothing") }}
      {%- endfor %}
      {%- if request.user.is_manager %}
      | <a href="{{ url_for('admin/edit_post', post_id=post.post_id)
        }}">{{ _('Edit') }}</a>
      {%- endif %}
    </p>
  </div>
  {%- if post.comments %}
    <h3>{{ _("Comments") }}</h3>
    {{ render_comments(post) }}
  {%- endif %}
  {%- if post.comments_enabled %}
    <h3 id="leave-reply">{{ _("Leave a Reply") }}</h3>
    {{ render_comment_editor(post, form) }}
  {%- endif %}
{% endblock %}
